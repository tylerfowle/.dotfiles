#!/bin/bash

echo "Starter 2.0.0"

[ -f "$PWD/**/*.scss" ] && sass=true || sass=false
[ -f "$PWD/gulpfile.js" ] && gulp=true || gulp=false
[ -f "$PWD/package.json" ] && package=true || package=false
[ -d "$PWD/build" ] && build=true || build=false
[ -d "$PWD/templates/layouts" ] && twig=true || twig=false
[ "$(type jq)" ] && jq_available=true || jq_available=false

echo "package: $package"
echo "gulp: $gulp"
echo "sass: $sass"
echo "build/: $build"
echo "templates/layouts/: $twig"
echo "jq available: $jq_available"

# launch build tools: gulp, npm scripts, codekit
if [ $package == true ]; then

  #test if npm start task exists
  if [[ $(jq '.scripts.start' package.json) == "null" ]]; then
    echo -e "\033[31m==> no task named: start \033[39m"
    jq '.scripts.start="gulp"' package.json | sponge package.json
  else
    echo -e "\033[92m==> found task: start \033[39m"
  fi

  echo -e "\033[92m==> package.json found \033[39m"
  if [ -d "$PWD/node_modules" ]; then
    echo -e "\033[92m==> node_modules already installed \033[39m"
    echo -e "\033[92m==> running npm start \033[39m"
    ## npm start
    npm start
  else
    echo -e "\033[92m==> node_modules not found \033[39m"
    echo -e "\033[92m==> running npm install \033[39m"
    echo -e "\033[92m==> running npm start \033[39m"
    npm install
    npm start
  fi

elif [ $gulp == true ]; then
  echo -e "\033[31m==> found gulpfile.js, but no package.json exists \033[39m"

elif [ $sass == true ]; then
  echo -e "\033[92m==> codekit found \033[39m"
  ## open codekit with current directory
  open -a /Applications/CodeKit.app/ .
fi
