#!/bin/bash

echo "Starter 2.0.0"

[ -f "$PWD/**/*.scss" ] && sass=true || sass=false
[ -f "$PWD/gulpfile.js" ] && gulp=true || gulp=false
[ -f "$PWD/package.json" ] && package=true || package=false
[ -d "$PWD/build" ] && build=true || build=false
[ -d "$PWD/templates/layouts" ] && twig=true || twig=false
[ "$(type jq)" ] && jq_available=true || jq_available=false

echo "sass: $sass"
echo "gulp: $gulp"
echo "package: $package"
echo "build/: $build"
echo "templates/layouts/: $twig"
echo "jq availability: $jq_available"

# launch build tools: gulp, npm scripts, codekit
if [ $package == true ]; then
  echo -e "\033[92m==> package.json found \033[39m"
  if [ -d "$PWD/node_modules" ]; then
    echo -e "\033[92m==> node_modules already installed \033[39m"
    echo -e "\033[92m==> running npm start \033[39m"
    ## npm start
    npm start
  else
    echo -e "\033[92m==> node_modules not found \033[39m"
    echo -e "\033[92m==> running npm install \033[39m"
    npm install
    npm start
  fi

elif [ $gulp == true ]; then
  echo -e "\033[92m==> gulp found \033[39m"
  if [ -d "$PWD/node_modules/gulp" ]; then
    echo -e "\033[92m==> success - starting gulp \033[39m"
    ## start default gulp task
    gulp
  else
    echo -e "\033[0;31m==> failed - gulp not installed \033[39m"
    echo -e "\033[92m==> running gup... \033[39m"
    ## run gup functions
    gup
  fi
elif [ $sass == true ]; then
  echo -e "\033[92m==> codekit found \033[39m"
  ## open codekit with current directory
  open -a /Applications/CodeKit.app/ .
fi
